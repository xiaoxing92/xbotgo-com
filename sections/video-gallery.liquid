{%- unless video_assets_output -%}
  <link rel='stylesheet' href='{{ 'video.css' | asset_url }}' {%- render 'lazy-stylesheet-attrs' %}>
  <script src='{{ 'video.js' | asset_url }}' defer></script>
{%- endunless -%}

<section id='section-id-{{ section.id }}' class='video-gallery'>
  <div class='grid-container'>
    {% for block in section.blocks %}
      {%- unless video_assets_output -%}
        <link rel='stylesheet' href='{{ 'video.css' | asset_url }}' {%- render 'lazy-stylesheet-attrs' %}>
        <script src='{{ 'video.js' | asset_url }}' defer></script>
      {%- endunless -%}

      {%- liquid
        assign video_assets_output = true
        assign using_video_tag = false
        if block.settings.video_shopify != blank
          assign using_video_tag = true
        endif
        if block.settings.placeholder_image
          assign placeholder_image = block.settings.placeholder_image
        elsif block.settings.video_shopify
          assign placeholder_image = block.settings.video_shopify.preview_image
        else
          assign placeholder_image = null
        endif
        assign autoplay = block.settings.autoplay
      -%}

      <div class='item-video'>
        <div
          class='height--adapt image-overlay image-overlay--bg-no_background'
          {% if placeholder_image %}
            style='--aspect-ratio: {{ placeholder_image.aspect_ratio }}'
          {% endif %}
          {%- render 'animation-attrs', attrs: 'data-cc-animate' -%}
        >
          <div class='image-overlay__image height__image'>
            <deferred-media>
              {%- if autoplay == false -%}
                <button type='button' class='js-load-media hidden' aria-hidden='true'></button>
              {%- endif -%}
              <template>
                <video-component
                  class='{% if using_video_tag %}has-video{% else %}has-iframe{% endif %}'
                  {%- unless using_video_tag %}
                    data-video-url='{{ section.settings.video_external | escape }}'
                  {% endunless %}
                  data-video-id='{{ section.id }}'
                  data-autoplay='{{ autoplay }}'
                  data-background='false'
                  data-description='{{ section.settings.video_description | escape }}'
                >
                  {%- if using_video_tag -%}
                    {{
                      section.settings.video_shopify
                      | video_tag:
                        playsinline: true,
                        controls: true,
                        autoplay: autoplay,
                        muted: autoplay,
                        loop: autoplay,
                        poster: ''
                      | replace: '<img ', '<img loading="lazy" hidden '
                    }}
                  {%- else -%}
                    <div></div>
                  {%- endif -%}
                </video-component>
              </template>
            </deferred-media>
            {% if placeholder_image %}
              {%- render 'image' with placeholder_image, class: 'video-played-hidden' -%}
            {% elsif autoplay == false %}
              <div class='placeholder-image video-played-hidden'>
                {{- 'lifestyle-1' | placeholder_svg_tag: 'placeholder-svg' -}}
              </div>
            {% endif %}
          </div>
          {%- if autoplay == false -%}
            <div class='text-overlay text-overlay--for-banner text-overlay--v-center text-overlay--h-center image-overlay__over video-played-hidden'>
              <div class='text-overlay__inner'>
                <div class='text-overlay__text'>
                  <video-section-play-button
                    role='button'
                    tabindex='0'
                    type='button'
                    class='button-row__btn video-section__play-btn inline-block'
                  >
                    <span class='visually-hidden'>{{ 'general.icon_labels.play' | t }}</span>
                    {%- render 'icon-play' -%}
                  </video-section-play-button>
                </div>
              </div>
            </div>
          {%- endif -%}
        </div>
      </div>
    {% endfor %}
  </div>
</section>

{% schema %}
{
  "name": "VideoGallery",
  "class": "section-videogallery",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "Recommend"
    }
  ],
  "blocks": [
    {
      "type": "video_block",
      "name": "VideoGaller",
      "settings": [
        {
            "id": "video_shopify",
            "type": "video",
            "label": "Video upload",
            "info": ".."
        },     
        {
            "type": "range",
            "id": "star_rating",
            "min": 0,
            "max": 5,
            "step": 1,
            "label": "Star rating",
            "default": 5
        },
        {
            "id": "video_external",
            "type": "text",
            "label": "External video",
            "default": "https://www.youtube.com/embed?video_id=fuX6zbSr2w4"
        },
        {
            "id": "textarea",
            "type": "textarea",
            "label": "Textarea",
            "default": "Default Content"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "VideoGallery",
      "settings": {},
      "blocks": [{ "type": "video_block" }, { "type": "video_block" }, { "type": "video_block" }]
    }
  ]
}
{% endschema %}

<style>
  .video-gallery .grid-container {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
  }
  .video-gallery .video-card {
    position: relative;
    border: 1px solid #ddd;
    border-radius: 8px;
    overflow: hidden;
  }
  .video-gallery .video-thumbnail {
    position: relative;
  }
  .video-gallery .video-thumbnail img {
    width: 100%;
    height: auto;
  }
  .video-gallery .video-thumbnail .play-icon {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.5);
    border-radius: 50%;
    padding: 10px;
  }
  .video-gallery .video-title {
    padding: 8px;
    font-size: 14px;
    text-align: center;
  }
</style>
